<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroSheet AI | Yaman Hamdoun</title>

    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="apple-touch-icon" href="/static/favicon.png">
    <meta name="theme-color" content="#4f46e5">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* 1. Dynamic Background */
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3 {
            font-family: 'Outfit', sans-serif;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. Glassmorphism */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 3. Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 4s ease-in-out infinite;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeInUp 0.8s ease-out forwards;
        }

        .progress-bar-transition {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Text Glow */
        .text-glow {
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
        }
        
        /* Heart Beat Animation for Like Button */
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }
        .animate-heart:active i {
            animation: heartBeat 0.5s linear;
        }

        /* Modal Animation */
        .modal-enter {
            animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes modalPop {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 lg:p-8 overflow-x-hidden relative">

    <div class="fixed top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0">
        <div class="absolute top-10 left-10 w-48 h-48 bg-indigo-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float"></div>
        <div class="absolute bottom-10 right-10 w-64 h-64 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float" style="animation-delay: 2s;"></div>
    </div>

    <div class="relative z-10 max-w-7xl w-full grid grid-cols-1 lg:grid-cols-3 gap-8 items-stretch">
        
        <div class="lg:col-span-2 glass-card rounded-3xl p-8 lg:p-10 animate-fade-in shadow-2xl flex flex-col justify-center relative">
            
            <div class="flex flex-col items-center justify-center mb-5">
                
                <div class="relative w-32 h-32 mb-4 animate-float">
                    <img src="/static/logo.png" 
                        alt="MicroSheet Logo" 
                        class="w-full h-full object-contain mix-blend-multiply filter contrast-125">
                    <div class="absolute inset-0 bg-indigo-400 rounded-full opacity-20 blur-2xl -z-10"></div>
                </div>

                <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 tracking-tight mb-4 text-glow text-center leading-tight">
                    MicroSheet AI
                </h1>
                
                <div class="inline-flex flex-col md:flex-row items-center gap-2 md:gap-3 px-6 py-3 rounded-2xl md:rounded-full bg-indigo-50 border border-indigo-100 shadow-sm mb-4">
                    <span class="text-[10px] md:text-xs font-bold tracking-widest text-gray-500 uppercase font-[Outfit]">Lecture Slides</span>
                    <i class="fas fa-long-arrow-alt-right text-indigo-500 text-lg animate-pulse transform rotate-90 md:rotate-0"></i>
                    <span class="text-[10px] md:text-xs font-bold tracking-widest text-indigo-600 uppercase font-[Outfit]">One Page Cheat Sheet</span>
                </div>

                <p class="text-center text-gray-500 text-xs md:text-sm max-w-md leading-relaxed font-medium mb-4">
                    Stop spending hours summarizing! Upload your lecture slides and let the AI generate a dense, exam-ready cheat sheet allowed in your exams.
                </p>

                <div class="inline-flex items-center bg-indigo-50/80 px-4 py-1.5 rounded-full border border-indigo-100 shadow-sm animate-fade-in" style="animation-delay: 0.5s;">
                    <span class="relative flex h-2 w-2 mr-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <span class="text-xs font-bold text-gray-600 font-[Outfit]">
                        <span id="automationsCount" class="text-indigo-600 text-base">0</span> Automations Generated
                    </span>
                </div>

            </div>

            <div id="uploadSection">
                <form id="uploadForm" class="space-y-8">
                    <label class="group relative flex flex-col items-center justify-center w-full h-64 border-3 border-indigo-100 border-dashed rounded-3xl cursor-pointer bg-indigo-50/50 hover:bg-white hover:border-indigo-500 hover:shadow-xl transition-all duration-300 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-br from-indigo-50 to-purple-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10 flex flex-col items-center justify-center pt-5 pb-6">
                            <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center shadow-md mb-4 group-hover:scale-110 transition-transform duration-300">
                                <i class="fas fa-cloud-upload-alt text-4xl text-indigo-500"></i>
                            </div>
                            <p class="mb-2 text-2xl text-gray-700 font-bold font-[Outfit]">Drop PDF Slides Here</p>
                            <p class="text-sm text-gray-400">or click to browse</p>
                        </div>
                        <input type="file" name="files" id="fileInput" multiple required class="hidden" onchange="showFileName()">
                    </label>

                    <div id="fileList" class="hidden text-center bg-indigo-100 text-indigo-900 py-3 rounded-xl font-bold text-sm border border-indigo-200"></div>

                    <button type="submit" class="flex items-center justify-center w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-5 rounded-2xl text-xl shadow-lg hover:shadow-indigo-500/40 transition-all transform hover:-translate-y-1 active:scale-95 font-[Outfit] tracking-widest uppercase">
                        Start Automation 
                        <svg class="w-6 h-6 ml-3 animate-pulse text-white" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C12 2 14.5 9.5 19 12C14.5 14.5 12 22 12 22C12 22 9.5 14.5 5 12C9.5 9.5 12 2 12 2Z"></path>
                        </svg>
                    </button>
                    <p class="text-center text-[10px] text-indigo-400/60 mt-3 font-medium">
                        By clicking Start, you agree to our 
                        <button type="button" onclick="openLegalModal()" class="underline decoration-dotted hover:text-indigo-400 transition-colors">Terms & Privacy Policy</button>.
                    </p>
                </form>
            </div>

            <div id="progressSection" class="hidden text-center py-12">
                <div class="mb-3 flex justify-between text-sm font-bold text-gray-600 px-1">
                    <span id="statusText" class="animate-pulse">Initializing engine...</span>
                    <span id="percentText">0%</span>
                </div>
                <div class="w-full bg-gray-100 rounded-full h-6 overflow-hidden shadow-inner p-1">
                    <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-purple-500 h-4 rounded-full progress-bar-transition relative" style="width: 0%">
                        <div class="absolute inset-0 bg-white opacity-20 animate-pulse"></div>
                    </div>
                </div>
                <p class="text-xs text-gray-400 mt-6 italic">
                    <i class="fas fa-info-circle mr-1"></i> Please keep this tab open, the tool is getting the job done!
                </p>
            </div>

            <div id="successSection" class="hidden text-center py-8">
                <div class="mb-6 inline-block relative">
                    <div class="absolute inset-0 bg-green-200 rounded-full blur-xl opacity-50 animate-pulse"></div>
                    <i class="fas fa-check-circle text-7xl text-green-500 relative z-10 animate-float"></i>
                </div>
                <h2 class="text-3xl font-extrabold text-gray-800 mb-2 font-[Outfit]">Done!</h2>
                <p class="text-gray-600 mb-8">Your compressed cheat sheet is ready.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="downloadAndShowModal()" class="flex items-center justify-center w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-2xl text-lg shadow-lg hover:shadow-green-500/40 transition-all transform hover:-translate-y-1 font-[Outfit]">
                        <i class="fas fa-file-download mr-2"></i> Download PDF
                    </button>
                    <button onclick="location.reload()" class="flex items-center justify-center w-full bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-4 rounded-2xl text-lg transition-colors font-[Outfit]">
                        <i class="fas fa-redo mr-2"></i> Start Over
                    </button>
                </div>
            </div>
        </div>

        <div class="lg:col-span-1 flex flex-col gap-6 animate-fade-in" style="animation-delay: 0.2s;">
            
            <div class="glass-dark rounded-3xl p-6 border border-white/10 shadow-xl text-center relative overflow-hidden group flex-grow flex flex-col justify-center">
                
                <div class="relative z-10 mb-8">
                    <div class="absolute top-0 right-0 -mr-16 -mt-16 w-32 h-32 bg-yellow-400/10 rounded-full blur-3xl group-hover:bg-yellow-400/20 transition-all duration-700"></div>

                    <h3 class="text-lg font-extrabold mb-2 text-yellow-300 font-[Outfit] tracking-widest uppercase flex items-center justify-center">
                        <i class="fas fa-lightbulb mr-2 animate-pulse"></i>
                        Got an Idea?
                    </h3>
                    <p class="text-indigo-100 text-xs mb-4 leading-relaxed">
                        I love building crazy AI tools. If you have a concept that needs engineering, let's build it together!
                    </p>
                    <a href="mailto:yaman.hamdoun27@gmail.com?subject=MicroSheet%20Collaboration%20Idea!&body=Hey%20Yaman%2C%0A%0AI%20was%20using%20MicroSheet%20and%20I%20had%20an%20idea...%0A" 
                       class="relative block w-full bg-white text-indigo-900 font-bold py-3 px-4 rounded-xl hover:bg-yellow-300 transition-all shadow-lg font-[Outfit] tracking-widest uppercase text-xs hover:scale-105 duration-300">
                        <i class="fas fa-paper-plane mr-2 text-indigo-600"></i>
                        Send Idea
                    </a>
                </div>

                <div class="w-full h-px bg-white/10 mb-8"></div>

                <div class="relative z-10">
                    <div class="absolute bottom-0 left-0 -ml-16 -mb-16 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl group-hover:bg-pink-500/20 transition-all duration-700"></div>

                    <h3 class="text-lg font-extrabold mb-2 text-pink-300 font-[Outfit] tracking-widest uppercase flex items-center justify-center">
                        <i class="fas fa-heart mr-2 animate-pulse"></i>
                        Do you like it?
                    </h3>
                    <p class="text-indigo-100 text-xs mb-4 leading-relaxed">
                        Hit the button below to show some love! It helps me keep the server running.
                    </p>
                    
                    <button onclick="likeTool()" id="likeButton"
                       class="animate-heart relative w-full bg-gradient-to-r from-pink-600 to-purple-600 text-white font-bold py-3 px-4 rounded-xl hover:from-pink-500 hover:to-purple-500 transition-all shadow-lg font-[Outfit] tracking-widest uppercase text-xs hover:scale-105 duration-300 active:scale-95">
                        <i class="fas fa-thumbs-up mr-2"></i>
                        Like (<span id="likeCount">...</span>)
                    </button>
                </div>

            </div>

            <div class="glass-dark rounded-3xl p-6 border border-white/5 text-center mt-auto">
                <p class="text-indigo-200 text-sm font-semibold mb-1">Developed with <i class="fas fa-heart text-red-400 mx-1 animate-pulse"></i> by</p>
                <p class="text-white font-bold text-lg font-[Outfit]">Yaman Hamdoun</p>
                <p class="text-indigo-300 text-xs mt-1">Software Engineering student at</p>
                <p class="text-indigo-300 text-xs">Leibniz University Hannover</p>
                
                <div class="mt-4 mb-2">
                    <a href="https://www.linkedin.com/in/yaman-hamdoun-4393aa270/" target="_blank" class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-indigo-600/50 hover:bg-blue-600 text-white transition-all transform hover:scale-110">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>

                <div class="mt-2 pt-4 border-t border-white/10 text-[10px] text-indigo-400 flex flex-col gap-1">
                    <span>&copy; <span id="currentYear"></span> MicroSheet AI. All Rights Reserved.</span>
                    <button onclick="openLegalModal()" class="hover:text-white underline decoration-dotted underline-offset-2 transition-colors">Terms & Privacy</button>
                </div>
            </div>
        </div>

    </div>

    <div id="donationModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeDonationModal()"></div>
        <div class="relative bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center modal-enter border border-indigo-100">
            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-heart text-3xl text-yellow-500 animate-pulse"></i>
            </div>
            
            <h3 class="text-2xl font-bold text-gray-800 mb-2 font-[Outfit]">Your File is Ready!</h3>
            <p class="text-gray-600 mb-6 leading-relaxed">
                If MicroSheet helped you, please consider sending a collaboration idea or liking the tool!
            </p>
            
            <div class="space-y-3">
                <button onclick="closeDonationModal()" class="flex items-center justify-center w-full bg-gray-100 hover:bg-gray-200 text-gray-500 font-bold py-3.5 rounded-xl transition-colors text-sm">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div id="legalModal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="closeLegalModal()"></div>
        <div class="relative bg-white/95 rounded-3xl shadow-2xl p-8 max-w-2xl w-full text-left modal-enter border border-indigo-100 max-h-[80vh] overflow-y-auto">
            
            <div class="flex justify-between items-center mb-6 border-b border-gray-200 pb-4">
                <h3 class="text-2xl font-bold text-gray-900 font-[Outfit]">Terms & Privacy Policy</h3>
                <button onclick="closeLegalModal()" class="text-gray-400 hover:text-red-500 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="prose prose-sm text-gray-600 space-y-4 font-sans leading-relaxed">
                <p class="text-xs text-gray-400 uppercase tracking-widest font-bold mb-2">Effective Date: <span id="legalDate"></span></p>

                <p>This agreement describes the conditions and rules under which <strong>MicroSheet AI</strong> ("we", "our") offers you its services.</p>
                
                <p>This agreement will be governed by the laws of <strong>Germany (Lower Saxony)</strong>, without reference to conflict of laws principles. You agree that any litigation relating to this agreement may only be brought in, and shall be subject to the jurisdiction of, any Court of Hannover, Germany.</p>

                <h4 class="text-indigo-900 font-bold text-lg mt-4">1. Terms of Use</h4>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>Use at Own Risk:</strong> The service is provided "as is". We bear no responsibility for errors in the generated cheat sheets. Always verify your study materials.</li>
                    <li><strong>Data Responsibility:</strong> You bear full responsibility for any files transmitted to our servers. Do not upload confidential or illegal materials.</li>
                    <li><strong>Academic Integrity:</strong> MicroSheet AI is a study aid. You agree not to use generated materials in violation of your university's exam regulations (e.g., if cheat sheets are not permitted).</li>
                    <li><strong>Availability:</strong> We reserve the right to modify or cease the service at any time without notice.</li>
                </ul>

                <h4 class="text-indigo-900 font-bold text-lg mt-4">2. Privacy & Data Handling</h4>
                <ul class="list-disc pl-5 space-y-1">
                    <li><strong>Ephemeral Storage:</strong> Your privacy is our priority. Submitted PDF files and generated Cheat Sheets are <strong>not permanently stored</strong>. They are automatically deleted from our servers immediately after processing or within a maximum of 1 hour.</li>
                    <li><strong>No Human Access:</strong> Your files are processed automatically by algorithms. No human (including the developer) views your content unless legally required by law enforcement.</li>
                    <li><strong>Third-Party Processing:</strong> We use Google Gemini AI for text summarization. By using this tool, you acknowledge that text extracted from your slides is processed by Google's API solely for the purpose of summarization, subject to Google's data policies.</li>
                    <li><strong>Analytics:</strong> We collect anonymous counters (e.g., "Total Automations") to improve the service. No personal identifiable information (PII) is tracked.</li>
                </ul>

                <h4 class="text-indigo-900 font-bold text-lg mt-4">3. Contact</h4>
                <p>
                    <strong>Yaman Hamdoun</strong><br>
                    Hannover, Germany<br>
                    Contact over LinkedIn
                </p>
            </div>
            
            <div class="mt-8 pt-4 border-t border-gray-200">
                <button onclick="closeLegalModal()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition-all shadow-lg">
                    I Understand
                </button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('currentYear').innerText = new Date().getFullYear();

        // --- FETCH STATS (Automations & Likes) ---
        async function fetchStats() {
            try {
                const res = await fetch('/api/stats');
                const data = await res.json();
                
                // Animate Automations
                animateValue("automationsCount", 0, data.automations, 2000);
                
                // Animate Likes
                document.getElementById("likeCount").innerText = data.likes;
                
            } catch(e) {
                console.log("Stats fetch error", e);
                document.getElementById("automationsCount").innerText = "150+";
                document.getElementById("likeCount").innerText = "10";
            }
        }

        // --- LIKE FUNCTION ---
        async function likeTool() {
            const btn = document.getElementById("likeButton");
            const countSpan = document.getElementById("likeCount");
            
            // Visual feedback immediately
            let current = parseInt(countSpan.innerText);
            if(isNaN(current)) current = 0;
            countSpan.innerText = current + 1;
            
            // Disable button to prevent spam
            btn.disabled = true;
            btn.classList.add("opacity-75");
            btn.innerHTML = '<i class="fas fa-check mr-2"></i> Liked!';

            try {
                await fetch('/api/like', { method: 'POST' });
            } catch(e) {
                console.error("Like error", e);
            }
        }

        // Animation Function (0 to N)
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // --- LEGAL MODAL LOGIC ---
        function openLegalModal() {
            document.getElementById('legalDate').innerText = new Date().toLocaleDateString();
            document.getElementById('legalModal').classList.remove('hidden');
        }
        function closeLegalModal() {
            document.getElementById('legalModal').classList.add('hidden');
        }

        // Call on load
        fetchStats();

        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        
        let readyFilename = "";

        function showFileName() {
            const list = document.getElementById('fileList');
            const files = fileInput.files;
            
            if (files.length > 0) {
                let totalSize = 0;
                
                // 1. Calculate total size
                for (let i = 0; i < files.length; i++) {
                    totalSize += files[i].size;
                }

                // 2. Check if total size > 16MB (16 * 1024 * 1024 bytes)
                const maxSize = 16 * 1024 * 1024;

                if (totalSize > maxSize) {
                    alert("Files are too large! Please upload the files with a total size of 128MB or lower.");
                    fileInput.value = ""; // Clear the selection
                    list.classList.add('hidden');
                    return;
                }

                // 3. If size is okay, show the count
                list.innerText = `${files.length} PDF(s) Selected`;
                list.classList.remove('hidden');
            }
        }

        form.onsubmit = async function(e) {
            e.preventDefault();
            
            document.getElementById('uploadSection').classList.add('hidden');
            document.getElementById('progressSection').classList.remove('hidden');

            const formData = new FormData(form);

            try {
                const response = await fetch('/upload', { method: 'POST', body: formData });
                const data = await response.json();
                
                if (data.error) {
                    alert(data.error);
                    location.reload();
                    return;
                }
                pollStatus(data.job_id);

            } catch (error) {
                alert("Upload failed. Please check connection.");
                console.error(error);
                location.reload();
            }
        };

        async function pollStatus(jobId) {
            const statusText = document.getElementById('statusText');
            const percentText = document.getElementById('percentText');
            const progressBar = document.getElementById('progressBar');

            const interval = setInterval(async () => {
                try {
                    const res = await fetch(`/status/${jobId}`);
                    const job = await res.json();

                    statusText.innerText = job.status;
                    percentText.innerText = `${job.percent}%`;
                    progressBar.style.width = `${job.percent}%`;

                    if (job.done) {
                        clearInterval(interval);
                        readyFilename = job.filename;
                        showSuccess();
                    }
                    
                    if (job.status.startsWith('Error')) {
                        clearInterval(interval);
                        alert(job.status);
                        location.reload();
                    }

                } catch (err) {
                    console.error("Polling error", err);
                }
            }, 1000);
        }

        function showSuccess() {
            document.getElementById('progressSection').classList.add('hidden');
            document.getElementById('successSection').classList.remove('hidden');
        }

        function downloadAndShowModal() {
            if (readyFilename) {
                window.location.href = `/download/${readyFilename}`;
            }
            setTimeout(() => {
                document.getElementById('donationModal').classList.remove('hidden');
            }, 1000);
        }

        function closeDonationModal() {
            document.getElementById('donationModal').classList.add('hidden');
        }
    </script>
</body>
</html>